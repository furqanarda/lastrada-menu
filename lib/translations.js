const fs = require('fs');
const path = require('path');

// Import Turkish translations
const trTranslations = require('../locales/tr.json');

// Function to extract translations from the TypeScript language context file
const extractTranslationsFromContext = () => {
  try {
    // Read the language context file
    const contextPath = path.join(__dirname, '../contexts/language-context.tsx');
    const contextContent = fs.readFileSync(contextPath, 'utf8');
    
    // Extract translations object using regex
    const translationsMatch = contextContent.match(/const translations: Record<Language, Record<string, string>> = ({[\s\S]*?});/);
    
    if (!translationsMatch) {
      console.warn('Could not extract translations from language context, using fallback');
      return getFallbackTranslations();
    }
    
    const translationsStr = translationsMatch[1];
    
    // Parse each language section
    const translations = {
      en: {},
      tr: trTranslations,
      el: {},
      bg: {}
    };
    
    // Extract English translations
    const enMatch = translationsStr.match(/en:\s*{([\s\S]*?)},\s*tr:/);
    if (enMatch) {
      extractKeyValuePairs(enMatch[1], translations.en);
    }
    
    // Extract Greek translations
    const elMatch = translationsStr.match(/el:\s*{([\s\S]*?)},\s*bg:/);
    if (elMatch) {
      extractKeyValuePairs(elMatch[1], translations.el);
    }
    
    // Extract Bulgarian translations
    const bgMatch = translationsStr.match(/bg:\s*{([\s\S]*?)}\s*$/);
    if (bgMatch) {
      extractKeyValuePairs(bgMatch[1], translations.bg);
    }
    
    return translations;
    
  } catch (error) {
    console.error('Error reading language context:', error);
    return getFallbackTranslations();
  }
};

// Helper function to extract key-value pairs from a string
const extractKeyValuePairs = (content, targetObj) => {
  // Match quoted key-value pairs, handling multi-line values
  const regex = /"([^"]+)":\s*"([^"]*(?:\\.[^"]*)*)"/g;
  let match;
  
  while ((match = regex.exec(content)) !== null) {
    const key = match[1];
    const value = match[2].replace(/\\"/g, '"'); // Unescape quotes
    targetObj[key] = value;
  }
};

// Fallback translations with email keys
const getFallbackTranslations = () => {
  return {
    en: {
      "email.newOrderReceived": "ðŸ½ï¸ New Order Received",
      "email.orderManagementSystem": "La Strada Restaurant - Order Management System",
      "email.orderDetails": "Order Details",
      "email.orderNumber": "Order Number",
      "email.orderTime": "Order Time",
      "email.location": "Location",
      "email.customerEmail": "Customer Email",
      "email.orderItems": "Order Items",
      "email.qty": "Qty",
      "email.item": "Item",
      "email.price": "Price",
      "email.note": "Note",
      "email.total": "Total",
      "email.actionRequired": "ðŸ“‹ Action Required:",
      "email.prepareOrderMessage": "Please prepare this order and ensure it's delivered to {location}.",
      "email.autoGeneratedMessage": "This email was automatically generated by the La Strada Restaurant ordering system.",
      "email.orderConfirmation": "âœ… Order Confirmation",
      "email.thankYouMessage": "Thank you for your order!",
      "email.yourOrderDetails": "Your Order Details",
      "email.deliveryLocation": "Delivery Location",
      "email.orderSummary": "Order Summary",
      "email.estimatedTime": "ðŸ• Estimated Preparation Time:",
      "email.estimatedTimeValue": "15-25 minutes",
      "email.deliveryLocationLabel": "ðŸ“ Delivery Location:",
      "email.thankYouFooter": "Thank you for choosing La Strada Restaurant!",
      "email.contactMessage": "If you have any questions about your order, please contact our reception."
    },
    tr: trTranslations,
    el: {
      "email.newOrderReceived": "ðŸ½ï¸ ÎÎ­Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± Î•Î»Î®Ï†Î¸Î·",
      "email.orderManagementSystem": "La Strada Restaurant - Î£ÏÏƒÏ„Î·Î¼Î± Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¹ÏŽÎ½",
      "email.orderDetails": "Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.orderNumber": "Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.orderTime": "ÎÏÎ± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.location": "Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±",
      "email.customerEmail": "Email Î ÎµÎ»Î¬Ï„Î·",
      "email.orderItems": "Î ÏÎ¿ÏŠÏŒÎ½Ï„Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.qty": "Î¤ÎµÎ¼.",
      "email.item": "Î ÏÎ¿ÏŠÏŒÎ½",
      "email.price": "Î¤Î¹Î¼Î®",
      "email.note": "Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·",
      "email.total": "Î£ÏÎ½Î¿Î»Î¿",
      "email.actionRequired": "ðŸ“‹ Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î· Î•Î½Î­ÏÎ³ÎµÎ¹Î±:",
      "email.prepareOrderMessage": "Î Î±ÏÎ±ÎºÎ±Î»Î¿ÏÎ¼Îµ Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î¬ÏƒÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÎºÎ±Î¹ Ï†ÏÎ¿Î½Ï„Î¯ÏƒÏ„Îµ Î½Î± Ï€Î±ÏÎ±Î´Î¿Î¸ÎµÎ¯ ÏƒÏ„Î¿ {location}.",
      "email.autoGeneratedMessage": "Î‘Ï…Ï„ÏŒ Ï„Î¿ email Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¹ÏŽÎ½ Ï„Î¿Ï… La Strada Restaurant.",
      "email.orderConfirmation": "âœ… Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.thankYouMessage": "Î£Î±Ï‚ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÏƒÎ±Ï‚!",
      "email.yourOrderDetails": "Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Ï„Î·Ï‚ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚ ÏƒÎ±Ï‚",
      "email.deliveryLocation": "Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚",
      "email.orderSummary": "Î£ÏÎ½Î¿ÏˆÎ· Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚",
      "email.estimatedTime": "ðŸ• Î•ÎºÏ„Î¹Î¼ÏŽÎ¼ÎµÎ½Î¿Ï‚ Î§ÏÏŒÎ½Î¿Ï‚ Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±Ï‚:",
      "email.estimatedTimeValue": "15-25 Î»ÎµÏ€Ï„Î¬",
      "email.deliveryLocationLabel": "ðŸ“ Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚:",
      "email.thankYouFooter": "Î£Î±Ï‚ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï€Î¿Ï… ÎµÏ€Î¹Î»Î­Î¾Î±Ï„Îµ Ï„Î¿ La Strada Restaurant!",
      "email.contactMessage": "Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÏƒÎ±Ï‚, ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î· ÏÎµÏƒÎµÏˆÎ¹ÏŒÎ½ Î¼Î±Ï‚."
    },
    bg: {
      "email.newOrderReceived": "ðŸ½ï¸ ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð° Ðµ ÐÐ¾Ð²Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°",
      "email.orderManagementSystem": "La Strada Restaurant - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð° Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ¸",
      "email.orderDetails": "Ð”ÐµÑ‚Ð°Ð¹Ð»Ð¸ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.orderNumber": "ÐÐ¾Ð¼ÐµÑ€ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.orderTime": "Ð§Ð°Ñ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.location": "ÐœÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",
      "email.customerEmail": "Ð˜Ð¼ÐµÐ¹Ð» Ð½Ð° ÐšÐ»Ð¸ÐµÐ½Ñ‚Ð°",
      "email.orderItems": "ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ð¸ Ð¾Ñ‚ ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.qty": "Ð‘Ñ€.",
      "email.item": "ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚",
      "email.price": "Ð¦ÐµÐ½Ð°",
      "email.note": "Ð‘ÐµÐ»ÐµÐ¶ÐºÐ°",
      "email.total": "ÐžÐ±Ñ‰Ð¾",
      "email.actionRequired": "ðŸ“‹ ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:",
      "email.prepareOrderMessage": "ÐœÐ¾Ð»Ñ, Ð¿Ñ€Ð¸Ð³Ð¾Ñ‚Ð²ÐµÑ‚Ðµ Ñ‚Ð°Ð·Ð¸ Ð¿Ð¾Ñ€ÑŠÑ‡ÐºÐ° Ð¸ ÑÐµ ÑƒÐ²ÐµÑ€ÐµÑ‚Ðµ, Ñ‡Ðµ ÑÐµ Ð´Ð¾ÑÑ‚Ð°Ð²Ñ Ð´Ð¾ {location}.",
      "email.autoGeneratedMessage": "Ð¢Ð¾Ð·Ð¸ Ð¸Ð¼ÐµÐ¹Ð» Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¾Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ñ‚Ð° Ð·Ð° Ð¿Ð¾Ñ€ÑŠÑ‡ÐºÐ¸ Ð½Ð° La Strada Restaurant.",
      "email.orderConfirmation": "âœ… ÐŸÐ¾Ñ‚Ð²ÑŠÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.thankYouMessage": "Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ð¼ Ð²Ð¸ Ð·Ð° Ð¿Ð¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°!",
      "email.yourOrderDetails": "Ð”ÐµÑ‚Ð°Ð¹Ð»Ð¸ Ð½Ð° Ð’Ð°ÑˆÐ°Ñ‚Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°",
      "email.deliveryLocation": "ÐÐ´Ñ€ÐµÑ Ð·Ð° Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ°",
      "email.orderSummary": "Ð ÐµÐ·ÑŽÐ¼Ðµ Ð½Ð° ÐŸÐ¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð°",
      "email.estimatedTime": "ðŸ• ÐŸÑ€Ð¸Ð±Ð»Ð¸Ð·Ð¸Ñ‚ÐµÐ»Ð½Ð¾ Ð’Ñ€ÐµÐ¼Ðµ Ð·Ð° ÐŸÑ€Ð¸Ð³Ð¾Ñ‚Ð²ÑÐ½Ðµ:",
      "email.estimatedTimeValue": "15-25 Ð¼Ð¸Ð½ÑƒÑ‚Ð¸",
      "email.deliveryLocationLabel": "ðŸ“ ÐÐ´Ñ€ÐµÑ Ð·Ð° Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ°:",
      "email.thankYouFooter": "Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð¸Ð¼ Ð²Ð¸, Ñ‡Ðµ Ð¸Ð·Ð±Ñ€Ð°Ñ…Ñ‚Ðµ La Strada Restaurant!",
      "email.contactMessage": "ÐÐºÐ¾ Ð¸Ð¼Ð°Ñ‚Ðµ Ð²ÑŠÐ¿Ñ€Ð¾ÑÐ¸ Ð¾Ñ‚Ð½Ð¾ÑÐ½Ð¾ Ð¿Ð¾Ñ€ÑŠÑ‡ÐºÐ°Ñ‚Ð° ÑÐ¸, Ð¼Ð¾Ð»Ñ ÑÐ²ÑŠÑ€Ð¶ÐµÑ‚Ðµ ÑÐµ Ñ Ð½Ð°ÑˆÐ°Ñ‚Ð° Ñ€ÐµÑ†ÐµÐ¿Ñ†Ð¸Ñ."
    }
  };
};

// Export translations
module.exports = {
  getTranslations: extractTranslationsFromContext,
  t: (key, language, translations) => {
    return translations[language]?.[key] || key;
  }
}; 